## auth-service-test

Тестовое задание в компанию MEDODS. Сервис авторизации, выдающий пару токенов и обслуживающий их обновление. Сервис написан на языке **Go**, использует **PostgreSQL**, **JWT**, содержит тесты и файлы **Docker** и сompose.

## Описание API

`/credentials?id=...` Выдает пару токенов по UUID в параметре запроса. Access токен формата **JWT**. Токен содержит данные об UUID, IP запроса и дате протухания. Выдается как HTTPOnly **сookie**. Refresh токен закодирован в **Base64** и передается в HTTPOnly **cookie**. Refresh токен зашифровывается и хранится с малой частью access токена в БД. Сервис также возвращает токены в теле ответа. Об этом в ТЗ не было сказано, и это никак не используется. Сделано для удобства проверки.

`/refresh` Принимает пару токенов в **cookie** заголовке запроса. Находит refresh токен в **PostgreSQL** по части access токена и сверяет его с полученным. Если это удалось сделать и IP пользователя не отличается от зашитого в токенах, сервис генерирует новую пару токенов, удаляет старую и высылает их в Set-Cookie заголовке.
Таким образом, нельзя изменить токены на стороне клиента, использовать refresh токен несколько раз и перемешивать токены по разным парам.

## Стек технологий
*Go, PostgreSQL, Docker, GIN, GORM, JWT*

## Setup
1. Клонировать проект командой `git clone https://github.com/Lixerus/auth-service-task.git`
2. Выполнить команду `docker compose build` из папки *deployments*
3. Для запуска сервиса выполнить `docker compose up`
4. Для запуска тестов зайдите в папку *internal/app* и выполните go test. Это можно сделать внутри работающего контейнера или локально(при наличии всех зависимостей).
5. Для остановки приложения выполните `docker compose down`
6. Также в папке *build* находится файл DockerfileBuild. Это альтернативный Dockerfile для 2-х этапной сборки приложения без Go и файлов программы.

> *PS*: Если вы дочитали до конца, вы молодец.